{"remainingRequest":"D:\\vue\\radar\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\radar\\src\\components\\Device\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\radar\\src\\components\\Device\\index.vue","mtime":1600308641055},{"path":"D:\\vue\\radar\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1596527896256},{"path":"D:\\vue\\radar\\node_modules\\babel-loader\\lib\\index.js","mtime":1596527889887},{"path":"D:\\vue\\radar\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1596527896256},{"path":"D:\\vue\\radar\\node_modules\\vue-loader\\lib\\index.js","mtime":1596528120726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport pagination from '@/components/utils/pagination'\r\nexport default {\r\n    components: {\r\n        pagination\r\n    },\r\n    data() {\r\n        let validateIPAddress = (rule, value, callback) => {\r\n            let regexp = /^((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}$/;\r\n            let valdata = value.split(',');\r\n            let isCorrect = true;\r\n            if (valdata.length) {\r\n                for (let i = 0; i < valdata.length; i++) {\r\n                    if (regexp.test(valdata[i]) == false) {\r\n                        isCorrect = false;\r\n                    }\r\n                }\r\n            }\r\n            console.log('value', value);\r\n            if (value == '') {\r\n                return callback(new Error('请输入iP地址'));\r\n            } else if (!isCorrect) {\r\n                callback(new Error('请输入正确的ip地址'));\r\n            } else {\r\n                callback()\r\n            }\r\n        }\r\n        return {\r\n            form: {\r\n                id: '',\r\n                name: '',\r\n                type: '',\r\n                subtype: '',\r\n                parentId: '',\r\n                hostIp: '',\r\n                ipmiIp: '',\r\n                slotPosition: '',\r\n                limit: 10,\r\n                pageIndex: 1,\r\n                pageSize: 10,\r\n                pageTotal: 0\r\n            },\r\n            items: [],\r\n            treedata: [],\r\n            defaultProps: {\r\n                children: 'sublist',\r\n                label: 'name'\r\n            },\r\n            tableData: [],\r\n            solts: [],\r\n            type: [],\r\n            deviceType: [],\r\n            subtype: [],\r\n            editVisible: false,\r\n            addVisible: false,\r\n            idx: -1,\r\n            rules: {\r\n                name: [{\r\n                        required: true,\r\n                        message: '请输入设备名称',\r\n                        trigger: 'blur'\r\n                    },\r\n                    {\r\n                        min: 3,\r\n                        max: 5,\r\n                        message: '长度在 3 到 5 个字符',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                type: [{\r\n                    required: true,\r\n                    message: '请选择设备类型',\r\n                    trigger: 'change'\r\n                }],\r\n                hostIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }],\r\n                ipmiIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }]\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        gettree() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/sys/device/select',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.treedata = res.data.data;\r\n                    for (var i = 0; i < res.data.data.length; i++) {\r\n                        this.items = res.data.data[i].sublist;\r\n                    }\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        gettype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=DeviceEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.type = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code) {\r\n                    typelable = this.type[i].value;\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        getDevicetype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=ChassisEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.deviceType = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        getSubtype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=BladeEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.subtype = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatsubType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code && this.type[i].code === 4) {\r\n                    for (var d = 0; d < this.deviceType.length; d++) {\r\n                        if (row.subtype === this.deviceType[d].code) {\r\n                            typelable = this.deviceType[d].value;\r\n                        }\r\n                    }\r\n                } else if (row.type === this.type[i].code && this.type[i].code === 5) {\r\n                    for (var j = 0; j < this.subtype.length; j++) {\r\n                        if (row.subtype === this.subtype[j].code) {\r\n                            typelable = this.subtype[j].value;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        //添加设备\r\n        addDevice() {\r\n            this.addVisible = true;\r\n        },\r\n        saveAdd(form) {\r\n            this.$refs[form].validate((valid) => {\r\n                if (valid) {\r\n                    this.addVisible = false;\r\n                    if (this.form.parentId == \"\") {\r\n                        this.form.parentId = this.items[0].parentId;\r\n                    }\r\n                    this.$axios({\r\n                        method: \"POST\",\r\n                        url: '/sys/device/save',\r\n                        data: JSON.stringify(this.form),\r\n                        headers: {\r\n                            'Content-Type': \"application/json\"\r\n                        },\r\n                        withCredentials: true,\r\n                    }).then((res) => {\r\n                        let data = res.data\r\n                        if (data.code == 0) {\r\n                            this.$message.success('操作完成');\r\n                            this.gettree(); //局部刷新表格               \r\n                        } else {\r\n                            this.$message.error(data.msg || '操作失败')\r\n                        }\r\n                        this.uploadLoading = false\r\n                    }).catch((e) => {\r\n                        this.uploadLoading = false\r\n                        this.$message.error(e)\r\n                    });\r\n                } else {\r\n                    console.log('error submit!!');\r\n                    return false;\r\n                }\r\n            });\r\n\r\n        },\r\n        // 触发搜索按钮\r\n        handleSearch() {\r\n            this.gettree();\r\n        },\r\n        // 删除操作\r\n        handleDelete(index, row) {\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n            // 确认删除\r\n            this.$confirm('确定要删除吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.saveDelete();\r\n            }).catch(() => {});\r\n        },\r\n        saveDelete() {\r\n            let ids = [];\r\n            ids.push(this.form.id + \"\");\r\n            console.log(ids);\r\n            this.$axios({\r\n                method: \"post\",\r\n                url: '/sys/device/delete',\r\n                data: JSON.stringify(ids),\r\n                // 设置请求头\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true, //跨域请求\r\n            }).then((res) => {\r\n                let data = res.data;\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    this.gettree(); //局部刷新表格                     \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        // 编辑操作\r\n        handleEdit(index, row) {\r\n            this.editVisible = true;\r\n            // this.idx = index;\r\n            this.form = row;\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n\r\n        },\r\n        // 保存编辑\r\n        saveEdit() {\r\n            console.log('this.form', this.form);\r\n            this.editVisible = false;\r\n            // 文件上传\r\n            this.$axios({\r\n                method: \"POST\",\r\n                url: '/sys/device/update',\r\n                data: JSON.stringify(this.form),\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true,\r\n            }).then((res) => {\r\n                let data = res.data\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    // this.$message.success(`修改第 ${this.idx + 1} 行成功`);\r\n                    this.gettree(); //局部刷新表格               \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        //控制树形菜单\r\n        handleNodeClick(data) {\r\n            if (data) {\r\n                if (data.sublist.length > 0) {\r\n                    this.items = data.sublist;\r\n                } else {\r\n                    var select = [];\r\n                    select.push(data);\r\n                    this.items = select;\r\n                }\r\n            }\r\n        },\r\n    },\r\n    created: function () {\r\n        this.gettype();\r\n        this.getDevicetype();\r\n        this.getSubtype();\r\n        this.gettree();\r\n    }\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/Device","sourcesContent":["<template>\r\n<div>\r\n    <div class=\"crumbs\">\r\n        <el-breadcrumb separator=\"/\">\r\n            <el-breadcrumb-item>\r\n                <i class=\"el-icon-lx-cascades\"></i> 设备管理\r\n            </el-breadcrumb-item>\r\n        </el-breadcrumb>\r\n    </div>\r\n    <div class=\"container\">\r\n        <el-row :gutter=\"20\">\r\n            <el-col :span=\"4\" style=\"height:400px\">\r\n                <el-card shadow=\"hover\" class=\"mgb20\">\r\n                    <div slot=\"header\" class=\"clearfix\">\r\n                        <span>设备列表</span>\r\n                    </div>\r\n                    <el-tree :data=\"treedata\" node-key=\"menuId\" :default-expanded-keys=\"[246]\" :props=\"defaultProps\" accordion @node-click=\"handleNodeClick\"></el-tree>\r\n                </el-card>\r\n            </el-col>\r\n            <el-col :span=\"20\">\r\n                <el-card shadow=\"hover\" class=\"mgb20\">\r\n                    <div class=\"handle-box\">\r\n                        <el-button class=\"handle-add mr10\" @click=\"addDevice\"><i class=\"el-icon-circle-plus\" style=\"font-size:12px;color:#00EC00;margin-right: 5px;\"></i>增加</el-button>\r\n                        <el-input placeholder=\"设备名\" v-model=\"form.name\" class=\"handle-input mr10\"></el-input>\r\n                        <el-button @click=\"handleSearch\"><i class=\"el-icon-search\" style=\"font-size:12px;color:blue;margin-right: 5px;\"></i>搜索</el-button>\r\n                    </div>\r\n                    <el-table :data=\"items\" style=\"width: 100%;margin-bottom: 20px;\" border stripe default-expand-all>\r\n                        <el-table-column prop=\"deviceId\" label=\"设备编号\"></el-table-column>\r\n                        <el-table-column prop=\"name\" label=\"设备名称\" width=\"180\"></el-table-column>\r\n\r\n                        <el-table-column prop=\"type\" label=\"设备类型\" width=\"180\" :formatter=\"formatType\"></el-table-column>\r\n                        <el-table-column prop=\"subtype\" label=\"设备子类型\" width=\"180\" :formatter=\"formatsubType\"></el-table-column>\r\n                        <el-table-column prop=\"hostIp\" label=\"主机IP\"></el-table-column>\r\n                        <el-table-column prop=\"ipmiIp\" label=\"BMCIP\"></el-table-column>\r\n                        <el-table-column prop=\"position\" label=\"槽位号\"></el-table-column>\r\n\r\n                        <el-table-column label=\"操作\" width=\"200\" align=\"center\">\r\n                            <template slot-scope=\"scope\">\r\n                                <el-button type=\"text\" icon=\"el-icon-edit\" @click=\"handleEdit(scope.$index, scope.row)\">编辑</el-button>\r\n                                <el-button type=\"text\" icon=\"el-icon-delete\" class=\"red\" @click=\"handleDelete(scope.$index, scope.row)\">删除</el-button>\r\n                            </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n\r\n                    <!--分页组件>\r\n                    <pagination  :query1=\"form\"/-->\r\n                </el-card>\r\n            </el-col>\r\n        </el-row>\r\n    </div>\r\n\r\n    <!-- 编辑弹出框 -->\r\n    <el-dialog title=\"编辑设备\" :visible.sync=\"editVisible\" width=\"30%\">\r\n        <el-form ref=\"form\" :model=\"form\" label-width=\"100px\" style=\"width: 300px; margin-left:50px;\">\r\n            <el-form-item label=\"设备名称\">\r\n                <el-input v-model=\"form.name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"设备类型\">\r\n                <el-radio-group v-model=\"form.type\">\r\n                    <el-radio :label=\"item.code\" :key=\"item.code\" v-for=\"item in type\">{{item.value}}</el-radio>\r\n                </el-radio-group>\r\n            </el-form-item>\r\n            <template v-if=\"form.type===4\">\r\n                <el-form-item label=\"设备子类型\">\r\n                    <el-select v-model=\"form.subtype\">\r\n                        <el-option v-for=\"device in deviceType\" :key=\"device.code\" :label=\"device.value\" :value=\"device.code\">{{device.value}}</el-option>\r\n                    </el-select>\r\n                    <!--el-radio-group v-model=\"form.subtype\">\r\n                        <el-radio :label=\"item.code\" :key=\"item.code\" v-for=\"item in deviceType\">{{item.value}}</el-radio>\r\n                    </el-radio-group-->\r\n                </el-form-item>\r\n            </template>\r\n            <template v-else-if=\"form.type===5\">\r\n                <el-form-item label=\"上级设备\">\r\n                    <el-select v-model=\"form.parentId\">\r\n                        <el-option v-for=\"tree in items\" :key=\"tree.menuId\" :label=\"tree.name\" :value=\"tree.menuId\">{{tree.name}}</el-option>\r\n                    </el-select>\r\n                    <!--el-radio-group v-model=\"form.subtype\">\r\n                        <el-radio :label=\"item.code\" :key=\"item.code\" v-for=\"item in deviceType\">{{item.value}}</el-radio>\r\n                    </el-radio-group-->\r\n                </el-form-item>\r\n                <el-form-item label=\"设备子类型\">\r\n                    <el-select v-model=\"form.subtype\">\r\n                        <el-option v-for=\"solt in subtype\" :key=\"solt.code\" :label=\"solt.value\" :value=\"solt.code\">{{solt.value}}</el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"主机IP\">\r\n                    <el-input v-model=\"form.hostIp\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"BMCIP\">\r\n                    <el-input v-model=\"form.ipmiIp\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"槽位号\">\r\n                    <el-input v-model=\"form.slotPosition\"></el-input>\r\n                </el-form-item>\r\n            </template>\r\n        </el-form>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"editVisible = false\">取 消</el-button>\r\n            <el-button type=\"primary\" @click=\"saveEdit\">确 定</el-button>\r\n        </span>\r\n    </el-dialog>\r\n\r\n    <!--增加弹出框-->\r\n    <el-dialog title=\"增加设备\" :visible.sync=\"addVisible\" width=\"40%\">\r\n        <el-form :model=\"form\" :rules=\"rules\" ref=\"form\" label-width=\"100px\" style=\"width: 400px; margin-left:50px;\">\r\n            <el-form-item label=\"设备名称\" prop=\"name\">\r\n                <el-input v-model=\"form.name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"设备类型\" prop=\"type\">\r\n                <el-radio-group v-model=\"form.type\">\r\n                    <el-radio :label=\"item.code\" :key=\"item.code\" v-for=\"item in type\">{{item.value}}</el-radio>\r\n                </el-radio-group>\r\n            </el-form-item>\r\n            <template v-if=\"form.type===4\">\r\n                <el-form-item label=\"设备子类型\">\r\n                    <el-select v-model=\"form.subtype\">\r\n                        <el-option v-for=\"device in deviceType\" :key=\"device.code\" :label=\"device.value\" :value=\"device.code\">{{device.value}}</el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n            </template>\r\n            <template v-else-if=\"form.type===5\">\r\n                <el-form-item label=\"上级设备\">\r\n                    <el-select v-model=\"form.parentId\">\r\n                        <el-option v-for=\"tree in items\" :key=\"tree.menuId\" :label=\"tree.name\" :value=\"tree.menuId\">{{tree.name}}</el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"设备子类型\">\r\n                    <el-select v-model=\"form.subtype\">\r\n                        <el-option v-for=\"solt in subtype\" :key=\"solt.code\" :label=\"solt.value\" :value=\"solt.code\">{{solt.value}}</el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"主机IP\" prop=\"hostIp\">\r\n                    <el-input v-model=\"form.hostIp\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"BMCIP\" prop=\"ipmiIp\">\r\n                    <el-input v-model=\"form.ipmiIp\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"槽位号\">\r\n                    <el-input v-model=\"form.slotPosition\"></el-input>\r\n                </el-form-item>\r\n            </template>\r\n        </el-form>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"addVisible = false\">取 消</el-button>\r\n            <el-button type=\"primary\" @click=\"saveAdd('form')\">确 定</el-button>\r\n        </span>\r\n    </el-dialog>\r\n\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport pagination from '@/components/utils/pagination'\r\nexport default {\r\n    components: {\r\n        pagination\r\n    },\r\n    data() {\r\n        let validateIPAddress = (rule, value, callback) => {\r\n            let regexp = /^((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}$/;\r\n            let valdata = value.split(',');\r\n            let isCorrect = true;\r\n            if (valdata.length) {\r\n                for (let i = 0; i < valdata.length; i++) {\r\n                    if (regexp.test(valdata[i]) == false) {\r\n                        isCorrect = false;\r\n                    }\r\n                }\r\n            }\r\n            console.log('value', value);\r\n            if (value == '') {\r\n                return callback(new Error('请输入iP地址'));\r\n            } else if (!isCorrect) {\r\n                callback(new Error('请输入正确的ip地址'));\r\n            } else {\r\n                callback()\r\n            }\r\n        }\r\n        return {\r\n            form: {\r\n                id: '',\r\n                name: '',\r\n                type: '',\r\n                subtype: '',\r\n                parentId: '',\r\n                hostIp: '',\r\n                ipmiIp: '',\r\n                slotPosition: '',\r\n                limit: 10,\r\n                pageIndex: 1,\r\n                pageSize: 10,\r\n                pageTotal: 0\r\n            },\r\n            items: [],\r\n            treedata: [],\r\n            defaultProps: {\r\n                children: 'sublist',\r\n                label: 'name'\r\n            },\r\n            tableData: [],\r\n            solts: [],\r\n            type: [],\r\n            deviceType: [],\r\n            subtype: [],\r\n            editVisible: false,\r\n            addVisible: false,\r\n            idx: -1,\r\n            rules: {\r\n                name: [{\r\n                        required: true,\r\n                        message: '请输入设备名称',\r\n                        trigger: 'blur'\r\n                    },\r\n                    {\r\n                        min: 3,\r\n                        max: 5,\r\n                        message: '长度在 3 到 5 个字符',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                type: [{\r\n                    required: true,\r\n                    message: '请选择设备类型',\r\n                    trigger: 'change'\r\n                }],\r\n                hostIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }],\r\n                ipmiIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }]\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        gettree() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/sys/device/select',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.treedata = res.data.data;\r\n                    for (var i = 0; i < res.data.data.length; i++) {\r\n                        this.items = res.data.data[i].sublist;\r\n                    }\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        gettype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=DeviceEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.type = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code) {\r\n                    typelable = this.type[i].value;\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        getDevicetype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=ChassisEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.deviceType = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        getSubtype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=BladeEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.subtype = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatsubType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code && this.type[i].code === 4) {\r\n                    for (var d = 0; d < this.deviceType.length; d++) {\r\n                        if (row.subtype === this.deviceType[d].code) {\r\n                            typelable = this.deviceType[d].value;\r\n                        }\r\n                    }\r\n                } else if (row.type === this.type[i].code && this.type[i].code === 5) {\r\n                    for (var j = 0; j < this.subtype.length; j++) {\r\n                        if (row.subtype === this.subtype[j].code) {\r\n                            typelable = this.subtype[j].value;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        //添加设备\r\n        addDevice() {\r\n            this.addVisible = true;\r\n        },\r\n        saveAdd(form) {\r\n            this.$refs[form].validate((valid) => {\r\n                if (valid) {\r\n                    this.addVisible = false;\r\n                    if (this.form.parentId == \"\") {\r\n                        this.form.parentId = this.items[0].parentId;\r\n                    }\r\n                    this.$axios({\r\n                        method: \"POST\",\r\n                        url: '/sys/device/save',\r\n                        data: JSON.stringify(this.form),\r\n                        headers: {\r\n                            'Content-Type': \"application/json\"\r\n                        },\r\n                        withCredentials: true,\r\n                    }).then((res) => {\r\n                        let data = res.data\r\n                        if (data.code == 0) {\r\n                            this.$message.success('操作完成');\r\n                            this.gettree(); //局部刷新表格               \r\n                        } else {\r\n                            this.$message.error(data.msg || '操作失败')\r\n                        }\r\n                        this.uploadLoading = false\r\n                    }).catch((e) => {\r\n                        this.uploadLoading = false\r\n                        this.$message.error(e)\r\n                    });\r\n                } else {\r\n                    console.log('error submit!!');\r\n                    return false;\r\n                }\r\n            });\r\n\r\n        },\r\n        // 触发搜索按钮\r\n        handleSearch() {\r\n            this.gettree();\r\n        },\r\n        // 删除操作\r\n        handleDelete(index, row) {\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n            // 确认删除\r\n            this.$confirm('确定要删除吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.saveDelete();\r\n            }).catch(() => {});\r\n        },\r\n        saveDelete() {\r\n            let ids = [];\r\n            ids.push(this.form.id + \"\");\r\n            console.log(ids);\r\n            this.$axios({\r\n                method: \"post\",\r\n                url: '/sys/device/delete',\r\n                data: JSON.stringify(ids),\r\n                // 设置请求头\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true, //跨域请求\r\n            }).then((res) => {\r\n                let data = res.data;\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    this.gettree(); //局部刷新表格                     \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        // 编辑操作\r\n        handleEdit(index, row) {\r\n            this.editVisible = true;\r\n            // this.idx = index;\r\n            this.form = row;\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n\r\n        },\r\n        // 保存编辑\r\n        saveEdit() {\r\n            console.log('this.form', this.form);\r\n            this.editVisible = false;\r\n            // 文件上传\r\n            this.$axios({\r\n                method: \"POST\",\r\n                url: '/sys/device/update',\r\n                data: JSON.stringify(this.form),\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true,\r\n            }).then((res) => {\r\n                let data = res.data\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    // this.$message.success(`修改第 ${this.idx + 1} 行成功`);\r\n                    this.gettree(); //局部刷新表格               \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        //控制树形菜单\r\n        handleNodeClick(data) {\r\n            if (data) {\r\n                if (data.sublist.length > 0) {\r\n                    this.items = data.sublist;\r\n                } else {\r\n                    var select = [];\r\n                    select.push(data);\r\n                    this.items = select;\r\n                }\r\n            }\r\n        },\r\n    },\r\n    created: function () {\r\n        this.gettype();\r\n        this.getDevicetype();\r\n        this.getSubtype();\r\n        this.gettree();\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.handle-box {\r\n    margin-bottom: 10px;\r\n}\r\n\r\n.handle-select {\r\n    width: 120px;\r\n}\r\n\r\n.handle-input {\r\n    width: 200px;\r\n    display: inline-block;\r\n}\r\n\r\n.table {\r\n    width: 100%;\r\n    font-size: 14px;\r\n}\r\n\r\n.red {\r\n    color: #ff0000;\r\n}\r\n\r\n.mr10 {\r\n    margin-right: 10px;\r\n}\r\n\r\n.table-td-thumb {\r\n    display: block;\r\n    margin: auto;\r\n    width: 40px;\r\n    height: 40px;\r\n}\r\n</style>\r\n"]}]}