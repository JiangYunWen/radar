{"remainingRequest":"D:\\vue\\radar\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\vue\\radar\\src\\components\\Device\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue\\radar\\src\\components\\Device\\index.vue","mtime":1600308641055},{"path":"D:\\vue\\radar\\node_modules\\babel-loader\\lib\\index.js","mtime":1596527889887},{"path":"D:\\vue\\radar\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1596527896256},{"path":"D:\\vue\\radar\\node_modules\\vue-loader\\lib\\index.js","mtime":1596528120726}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport pagination from '@/components/utils/pagination'\r\nexport default {\r\n    components: {\r\n        pagination\r\n    },\r\n    data() {\r\n        let validateIPAddress = (rule, value, callback) => {\r\n            let regexp = /^((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}$/;\r\n            let valdata = value.split(',');\r\n            let isCorrect = true;\r\n            if (valdata.length) {\r\n                for (let i = 0; i < valdata.length; i++) {\r\n                    if (regexp.test(valdata[i]) == false) {\r\n                        isCorrect = false;\r\n                    }\r\n                }\r\n            }\r\n            console.log('value', value);\r\n            if (value == '') {\r\n                return callback(new Error('请输入iP地址'));\r\n            } else if (!isCorrect) {\r\n                callback(new Error('请输入正确的ip地址'));\r\n            } else {\r\n                callback()\r\n            }\r\n        }\r\n        return {\r\n            form: {\r\n                id: '',\r\n                name: '',\r\n                type: '',\r\n                subtype: '',\r\n                parentId: '',\r\n                hostIp: '',\r\n                ipmiIp: '',\r\n                slotPosition: '',\r\n                limit: 10,\r\n                pageIndex: 1,\r\n                pageSize: 10,\r\n                pageTotal: 0\r\n            },\r\n            items: [],\r\n            treedata: [],\r\n            defaultProps: {\r\n                children: 'sublist',\r\n                label: 'name'\r\n            },\r\n            tableData: [],\r\n            solts: [],\r\n            type: [],\r\n            deviceType: [],\r\n            subtype: [],\r\n            editVisible: false,\r\n            addVisible: false,\r\n            idx: -1,\r\n            rules: {\r\n                name: [{\r\n                        required: true,\r\n                        message: '请输入设备名称',\r\n                        trigger: 'blur'\r\n                    },\r\n                    {\r\n                        min: 3,\r\n                        max: 5,\r\n                        message: '长度在 3 到 5 个字符',\r\n                        trigger: 'blur'\r\n                    }\r\n                ],\r\n                type: [{\r\n                    required: true,\r\n                    message: '请选择设备类型',\r\n                    trigger: 'change'\r\n                }],\r\n                hostIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }],\r\n                ipmiIp: [{\r\n                    required: true,\r\n                    validator: validateIPAddress,\r\n                    trigger: ['blur']\r\n                }]\r\n\r\n            }\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        gettree() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/sys/device/select',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.treedata = res.data.data;\r\n                    for (var i = 0; i < res.data.data.length; i++) {\r\n                        this.items = res.data.data[i].sublist;\r\n                    }\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        gettype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=DeviceEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.type = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code) {\r\n                    typelable = this.type[i].value;\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        getDevicetype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=ChassisEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.deviceType = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        getSubtype() {\r\n            this.$axios({\r\n                method: \"get\",\r\n                url: '/getData/getEnum?enumName=BladeEnum',\r\n                withCredentials: true,\r\n            }).then(res => {\r\n                if (res.data.code == 0) {\r\n                    this.subtype = res.data.data;\r\n                } else {\r\n                    this.$message.error(res.data.msg);\r\n                }\r\n            }).catch(error => {\r\n                this.$message.error('获取数据失败！');\r\n            });\r\n        },\r\n        formatsubType(row, column) {\r\n            var typelable = '';\r\n            for (var i = 0; i < this.type.length; i++) {\r\n                if (row.type === this.type[i].code && this.type[i].code === 4) {\r\n                    for (var d = 0; d < this.deviceType.length; d++) {\r\n                        if (row.subtype === this.deviceType[d].code) {\r\n                            typelable = this.deviceType[d].value;\r\n                        }\r\n                    }\r\n                } else if (row.type === this.type[i].code && this.type[i].code === 5) {\r\n                    for (var j = 0; j < this.subtype.length; j++) {\r\n                        if (row.subtype === this.subtype[j].code) {\r\n                            typelable = this.subtype[j].value;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return typelable;\r\n        },\r\n        //添加设备\r\n        addDevice() {\r\n            this.addVisible = true;\r\n        },\r\n        saveAdd(form) {\r\n            this.$refs[form].validate((valid) => {\r\n                if (valid) {\r\n                    this.addVisible = false;\r\n                    if (this.form.parentId == \"\") {\r\n                        this.form.parentId = this.items[0].parentId;\r\n                    }\r\n                    this.$axios({\r\n                        method: \"POST\",\r\n                        url: '/sys/device/save',\r\n                        data: JSON.stringify(this.form),\r\n                        headers: {\r\n                            'Content-Type': \"application/json\"\r\n                        },\r\n                        withCredentials: true,\r\n                    }).then((res) => {\r\n                        let data = res.data\r\n                        if (data.code == 0) {\r\n                            this.$message.success('操作完成');\r\n                            this.gettree(); //局部刷新表格               \r\n                        } else {\r\n                            this.$message.error(data.msg || '操作失败')\r\n                        }\r\n                        this.uploadLoading = false\r\n                    }).catch((e) => {\r\n                        this.uploadLoading = false\r\n                        this.$message.error(e)\r\n                    });\r\n                } else {\r\n                    console.log('error submit!!');\r\n                    return false;\r\n                }\r\n            });\r\n\r\n        },\r\n        // 触发搜索按钮\r\n        handleSearch() {\r\n            this.gettree();\r\n        },\r\n        // 删除操作\r\n        handleDelete(index, row) {\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n            // 确认删除\r\n            this.$confirm('确定要删除吗？', '提示', {\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.saveDelete();\r\n            }).catch(() => {});\r\n        },\r\n        saveDelete() {\r\n            let ids = [];\r\n            ids.push(this.form.id + \"\");\r\n            console.log(ids);\r\n            this.$axios({\r\n                method: \"post\",\r\n                url: '/sys/device/delete',\r\n                data: JSON.stringify(ids),\r\n                // 设置请求头\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true, //跨域请求\r\n            }).then((res) => {\r\n                let data = res.data;\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    this.gettree(); //局部刷新表格                     \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        // 编辑操作\r\n        handleEdit(index, row) {\r\n            this.editVisible = true;\r\n            // this.idx = index;\r\n            this.form = row;\r\n            if (row.type === 4) {\r\n                this.form.id = row.menuId;\r\n            } else {\r\n                this.form.id = row.deviceId;\r\n            }\r\n\r\n        },\r\n        // 保存编辑\r\n        saveEdit() {\r\n            console.log('this.form', this.form);\r\n            this.editVisible = false;\r\n            // 文件上传\r\n            this.$axios({\r\n                method: \"POST\",\r\n                url: '/sys/device/update',\r\n                data: JSON.stringify(this.form),\r\n                headers: {\r\n                    'Content-Type': \"application/json\"\r\n                },\r\n                withCredentials: true,\r\n            }).then((res) => {\r\n                let data = res.data\r\n                if (data.code == 0) {\r\n                    this.$message.success('操作完成');\r\n                    // this.$message.success(`修改第 ${this.idx + 1} 行成功`);\r\n                    this.gettree(); //局部刷新表格               \r\n                } else {\r\n                    this.$message.error(data.msg || '操作失败')\r\n                }\r\n            }).catch((e) => {\r\n                this.$message.error(e)\r\n            });\r\n        },\r\n        //控制树形菜单\r\n        handleNodeClick(data) {\r\n            if (data) {\r\n                if (data.sublist.length > 0) {\r\n                    this.items = data.sublist;\r\n                } else {\r\n                    var select = [];\r\n                    select.push(data);\r\n                    this.items = select;\r\n                }\r\n            }\r\n        },\r\n    },\r\n    created: function () {\r\n        this.gettype();\r\n        this.getDevicetype();\r\n        this.getSubtype();\r\n        this.gettree();\r\n    }\r\n}\r\n",null]}